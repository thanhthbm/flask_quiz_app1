{% extends "base.html" %}
{% block title %}Add Questions Â· Admin{% endblock %}
{% block content %}
<h2>Add Questions</h2>

<form method="post" enctype="multipart/form-data" class="card" style="max-width:720px;">
  {{ form.csrf_token }}

  <div class="row">
    <!-- Subject -->
    <div>
      {{ form.subject_id.label }}
      {{ form.subject_id(class="input") }}
      {% for error in form.subject_id.errors %}
        <p class="text-danger">{{ error }}</p>
      {% endfor %}
    </div>

    <!-- Input method -->
    <div>
      {{ form.input_method.label }}
      {{ form.input_method(class="input") }}
      {% for error in form.input_method.errors %}
        <p class="text-danger">{{ error }}</p>
      {% endfor %}
    </div>
  </div>

  <!-- Manual mode -->
  <div id="manual-box" style="margin-top:12px;">
    {{ form.content.label }}
    {{ form.content(class="input", rows="3", placeholder="Question content...") }}
    {% for error in form.content.errors %}
      <p class="text-danger">{{ error }}</p>
    {% endfor %}

    <div class="row" style="margin-top:8px;">
      <div>
        {{ form.option_a.label }}
        {{ form.option_a(class="input") }}
        {% for error in form.option_a.errors %}
          <p class="text-danger">{{ error }}</p>
        {% endfor %}
      </div>
      <div>
        {{ form.option_b.label }}
        {{ form.option_b(class="input") }}
        {% for error in form.option_b.errors %}
          <p class="text-danger">{{ error }}</p>
        {% endfor %}
      </div>
      <div>
        {{ form.option_c.label }}
        {{ form.option_c(class="input") }}
        {% for error in form.option_c.errors %}
          <p class="text-danger">{{ error }}</p>
        {% endfor %}
      </div>
      <div>
        {{ form.option_d.label }}
        {{ form.option_d(class="input") }}
        {% for error in form.option_d.errors %}
          <p class="text-danger">{{ error }}</p>
        {% endfor %}
      </div>
    </div>

    <div style="margin-top:8px;">
      {{ form.correct_answer.label }}
      {{ form.correct_answer(class="input") }}
      {% for error in form.correct_answer.errors %}
        <p class="text-danger">{{ error }}</p>
      {% endfor %}
    </div>
  </div>

  <!-- File upload mode -->
  <div id="file-box" style="display:none; margin-top:12px;">
    {{ form.file.label }}
    {{ form.file(class="input", accept=".txt,.csv,.json") }}
    <p class="muted">TXT format: <code>content|A|B|C|D|answer</code></p>
    {% for error in form.file.errors %}
      <p class="text-danger">{{ error }}</p>
    {% endfor %}
  </div>

  <div style="margin-top:12px;">
    {{ form.submit(class="btn primary") }}
    <a class="btn" href="{{ url_for('admin.subjects') }}">Back to Subjects</a>
  </div>
</form>

<script>
  const methodEl = document.querySelector('[name="{{ form.input_method.name }}"]');
  const manualBox = document.getElementById('manual-box');
  const fileBox = document.getElementById('file-box');
  function toggleBoxes() {
    const v = methodEl.value;
    manualBox.style.display = v === 'manual' ? 'block' : 'none';
    fileBox.style.display = v === 'file' ? 'block' : 'none';
  }
  methodEl.addEventListener('change', toggleBoxes);
  toggleBoxes();
</script>
{% endblock %}
